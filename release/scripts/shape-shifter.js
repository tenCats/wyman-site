!function(t){var e={init:function(){var i=t.location.href,n=i.indexOf("?a=");e.Drawing.init("#canvas-final"),-1!==n?e.UI.simulate(decodeURI(i).substring(n+3)):e.UI.simulate(""),e.Drawing.loop(function(){e.Shape.render()})}};e.Drawing=function(){var i,n,a;return requestFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},{init:function(a){i=document.querySelector(a),n=i.getContext("2d"),this.adjustCanvas(),t.addEventListener("resize",function(t){e.Drawing.adjustCanvas()})},loop:function(e){a=a?a:e,this.clearFrame(),a(),requestFrame.call(t,this.loop.bind(this))},adjustCanvas:function(){i.width=t.innerWidth,i.height=t.innerHeight},clearFrame:function(){n.clearRect(0,0,i.width,i.height)},getArea:function(){return{w:i.width,h:i.height}},drawCircle:function(t,e){n.fillStyle=e.render(),n.beginPath(),n.arc(t.x,t.y,t.z,0,2*Math.PI,!0),n.closePath(),n.fill()}}}(),e.UI=function(){function t(t){var e=t.getHours(),i=t.getMinutes(),i=10>i?"0"+i:i;return e+":"+i}function i(t){return t&&t.split(" ")[1]}function n(t){return t=t&&t.split(" ")[0],t&&t[0]===l&&t.substring(1)}function a(t,e,i,n){clearInterval(r),s=n?i:1,t(s),(!i||!n&&i>s||n&&s>0)&&(r=setInterval(function(){s=n?s-1:s+1,t(s),(!n&&i&&s===i||n&&0===s)&&clearInterval(r)},e))}function h(r){var s,r,d;u="object"==typeof r?r:u.concat(r.split("|")),a(function(f){switch(d=u.shift(),s=n(d),r=i(d),s){case"countdown":r=parseInt(r)||10,r=r>0?r:10,a(function(t){0===t?0===u.length?e.Shape.switchShape(e.ShapeBuilder.letter("")):h(u):e.Shape.switchShape(e.ShapeBuilder.letter(t),!0)},1e3,r,!0);break;case"rectangle":r=r&&r.split("x"),r=r&&2===r.length?r:[c,c/2],e.Shape.switchShape(e.ShapeBuilder.rectangle(Math.min(c,parseInt(r[0])),Math.min(c,parseInt(r[1]))));break;case"circle":r=parseInt(r)||c,r=Math.min(r,c),e.Shape.switchShape(e.ShapeBuilder.circle(r));break;case"time":var p=t(new Date);u.length>0?e.Shape.switchShape(e.ShapeBuilder.letter(p)):a(function(){p=t(new Date),p!==o&&(o=p,e.Shape.switchShape(e.ShapeBuilder.letter(o)))},1e3);break;default:e.Shape.switchShape(e.ShapeBuilder.letter(d[0]===l?"What?":d))}},2e3,u.length)}var r,s,o,c=(document.querySelector(".canvas"),30),u=[],l="#";return{simulate:function(t){h(t)}}}(),e.Point=function(t){this.x=t.x,this.y=t.y,this.z=t.z,this.a=t.a,this.h=t.h},e.Color=function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n},e.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},e.Dot=function(t,i){this.p=new e.Point({x:t,y:i,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new e.Color(255,255,255,this.p.a),this.t=this.clone(),this.q=[]},e.Dot.prototype={clone:function(){return new e.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,e.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(t){var e=this.distanceTo(t,!0),i=e[0],n=e[1],a=e[2],h=this.e*a;if(-1===this.p.h)return this.p.x=t.x,this.p.y=t.y,!0;if(a>1)this.p.x-=i/a*h,this.p.y-=n/a*h;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var t=this.q.shift();t?(this.t.x=t.x||this.p.x,this.t.y=t.y||this.p.y,this.t.z=t.z||this.p.z,this.t.a=t.a||this.p.a,this.p.h=t.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new e.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(t,e){var i=this.p.x-t.x,n=this.p.y-t.y,a=Math.sqrt(i*i+n*n);return e?[i,n,a]:a},move:function(t,e){(!e||e&&this.distanceTo(t)>1)&&this.q.push(t)},render:function(){this._update(),this._draw()}},e.ShapeBuilder=function(){function i(){c.width=Math.floor(t.innerWidth/o)*o,c.height=Math.floor(t.innerHeight/o)*o,u.fillStyle="red",u.textBaseline="middle",u.textAlign="center"}function n(){var t=u.getImageData(0,0,c.width,c.height).data;dots=[],x=0,y=0,fx=c.width,fy=c.height,w=0,h=0;for(var i=0;i<t.length;i+=4*o)t[i+3]>0&&(dots.push(new e.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=o,x>=c.width&&(x=0,y+=o,i+=4*o*c.width);return{dots:dots,w:w+fx,h:h+fy}}function a(t){u.font="bold "+t+"px "+d}function r(t){return!isNaN(parseFloat(t))&&isFinite(t)}function s(){i(),t.addEventListener("resize",i)}var o=5,c=document.createElement("canvas"),u=c.getContext("2d"),l=500,d="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return s(),{imageFile:function(t,i){var a=new Image,h=e.Drawing.getArea();a.onload=function(){u.clearRect(0,0,c.width,c.height),u.drawImage(this,0,0,.6*h.h,.6*h.h),i(n())},a.onerror=function(){i(e.ShapeBuilder.letter("What?"))},a.src=t},circle:function(t){var e=Math.max(0,t)/2;return u.clearRect(0,0,c.width,c.height),u.beginPath(),u.arc(e*o,e*o,e*o,0,2*Math.PI,!1),u.fill(),u.closePath(),n()},letter:function(t){var e=0;return a(l),e=Math.min(l,c.width/u.measureText(t).width*.8*l,c.height/l*(r(t)?1:.45)*l),a(e),u.clearRect(0,0,c.width,c.height),u.fillText(t,c.width/2,c.height/2),n()},rectangle:function(t,i){for(var n=[],a=o*t,h=o*i,r=0;h>r;r+=o)for(var s=0;a>s;s+=o)n.push(new e.Point({x:s,y:r}));return{dots:n,w:a,h:h}}}}(),e.Shape=function(){function t(){var t=e.Drawing.getArea();h=t.w/2-n/2,r=t.h/2-a/2}var i=[],n=0,a=0,h=0,r=0;return{shuffleIdle:function(){for(var t=e.Drawing.getArea(),n=0;n<i.length;n++)i[n].s||i[n].move({x:Math.random()*t.w,y:Math.random()*t.h})},switchShape:function(s,o){var c,u=e.Drawing.getArea();if(n=s.w,a=s.h,t(),s.dots.length>i.length){c=s.dots.length-i.length;for(var l=1;c>=l;l++)i.push(new e.Dot(u.w/2,u.h/2))}for(var l=0,d=0;s.dots.length>0;)d=Math.floor(Math.random()*s.dots.length),i[l].e=o?.25:i[l].s?.14:.11,i[l].s?i[l].move(new e.Point({z:20*Math.random()+10,a:Math.random(),h:18})):i[l].move(new e.Point({z:5*Math.random()+5,h:o?18:30})),i[l].s=!0,i[l].move(new e.Point({x:s.dots[d].x+h,y:s.dots[d].y+r,a:1,z:2,h:0})),s.dots=s.dots.slice(0,d).concat(s.dots.slice(d+1)),l++;for(var d=l;d<i.length;d++)i[d].s&&(i[d].move(new e.Point({z:20*Math.random()+10,a:Math.random(),h:20})),i[d].s=!1,i[d].e=.04,i[d].move(new e.Point({x:Math.random()*u.w,y:Math.random()*u.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var t=0;t<i.length;t++)i[t].render()}}}(),e.init(),t.shapeShifter=e.UI.simulate}(window);